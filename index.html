<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="./styles/global.css" />
    <link rel="stylesheet" href="./styles/category-page.css" />
    <script>
      const loaded = document.getElementsByClassName('loaded')
      const loader = document.getElementsByClassName('loader')
      function load(){
          loaded[0].classList.toggle('hidden')
          loader[0].classList.toggle('hidden')
      }

      window.addEventListener('DOMContentLoaded', function (){
        load()
      })

      async function fetchProducts() {
        const apiEndpoint = `https://script.google.com/macros/s/AKfycbyOIoDG-vn2lDNgsvUxvzFhpqfGXLDQEWTUVrQBlqOJO5wyrmKoLukNKPJXozdzxZyN/exec`;
      
        const responseProducts = await fetch(apiEndpoint)
          .then((x) => x.json())
          .catch((e) => {
            console.error(e); // error handling
            return []; //returns no-results
          });
        sessionStorage.setItem('allProducts', JSON.stringify(responseProducts))
        console.log('All Products Storaged', sessionStorage.getItem('allProducts'))
        load()
      }
      fetchProducts()

    </script>
    <style>
      .intro {
        padding-top: 4rem;
        padding-bottom: 4rem;

        text-align: center;
        
        & .logo {
          display: inline-block;
        }
      }

      
      .card-link {
        border-radius: 12px;
        padding: .75rem;

        &.novidades {
          display: flex;
          flex-direction: column;
          justify-content: end;
          
          min-height: 157px;
          background-size: cover;
          aspect-ratio: 353 / 250;

          margin-bottom: 2.5rem;
        }
      }

      .list-products {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        padding-bottom: 48px;

        & li {
          list-style-type: none;
        }
        & img {
          object-fit: cover;
          width: 100%;
          border-radius: 12px;
          margin-bottom: 12px;
        }

        a { color: #BF208F; text-decoration: none; }

        & p { margin-bottom: 8px; }
      }

      .h6 { margin-bottom: 1.25rem; }
      
      .loader, .loaded { transition: opacity .2s ease-in-out; }

      .hidden{
        pointer-events: none;
        opacity: 0;
      }

      .loader {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <div class="loader hidden"><img src="./img/loading.gif" alt="carregamento"></div>
    <div class="wrapper-body loaded">
      <div class="intro">
        <div>Catálogo</div>
        <svg class="logo" width="157" height="58" viewBox="0 0 157 58" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M54.7647 56.8529H53.3457V46.6133H58.9215V47.8605H54.7647V51.2254H58.3052V52.4726H54.7647V56.8529Z" fill="#544F45"/>
          <path d="M70.546 56.8529H69.127V46.6133H70.546V56.8529Z" fill="#544F45"/>
          <path d="M85.1983 56.8529H83.7793V47.8605H80.3105V46.6133H88.667V47.8605H85.1983V56.8529Z" fill="#544F45"/>
          <path d="M99.8468 56.8529H98.4277V46.6133H99.8324L104.333 53.2704C104.562 53.6042 104.878 54.1698 105.05 54.5032L105.179 54.7499H105.207C105.136 54.1408 105.107 53.6477 105.107 53.2704V46.6133H106.526V56.8529H105.136L100.621 50.2103C100.391 49.8765 100.076 49.2965 99.9041 48.9631L99.7751 48.7164H99.7464C99.8181 49.3255 99.8468 49.8185 99.8468 50.2103V56.8529Z" fill="#544F45"/>
          <path d="M123.7 56.8529H117.58V46.6133H123.457V47.8605H118.999V51.0658H122.625V52.3134H118.999V55.6057H123.7V56.8529Z" fill="#544F45"/>
          <path d="M133.483 55.8088L133.34 55.6786L134.143 54.5906C134.2 54.6486 134.257 54.7066 134.615 54.9824C135.089 55.3158 135.805 55.6931 136.723 55.6931C137.712 55.6931 138.471 55.1126 138.471 54.1846C138.471 51.9799 133.569 52.4294 133.569 49.2968C133.569 48.499 133.87 47.8173 134.487 47.2662C135.103 46.7152 135.891 46.4395 136.837 46.4395C137.396 46.4395 137.912 46.5265 138.385 46.7007C138.858 46.8748 139.202 47.0486 139.403 47.2227L139.704 47.4694L139.059 48.6586C138.987 48.5861 138.887 48.5135 138.758 48.4119C138.629 48.3103 138.371 48.1801 137.984 48.0205C137.597 47.8609 137.224 47.7738 136.837 47.7738C135.791 47.7738 135.003 48.4409 135.003 49.2677C135.003 50.0365 135.762 50.5585 136.723 50.9504C138.127 51.4869 139.933 52.2266 139.904 54.1411C139.904 54.9679 139.618 55.6495 139.03 56.2006C138.443 56.7517 137.669 57.0274 136.694 57.0274C135.003 57.0274 133.827 56.1861 133.483 55.8088Z" fill="#544F45"/>
          <path d="M149.624 55.8088L149.48 55.6786L150.283 54.5906C150.341 54.6486 150.398 54.7066 150.756 54.9824C151.229 55.3158 151.946 55.6931 152.863 55.6931C153.852 55.6931 154.612 55.1126 154.612 54.1846C154.612 51.9799 149.71 52.4294 149.71 49.2968C149.71 48.499 150.011 47.8173 150.627 47.2662C151.244 46.7152 152.032 46.4395 152.978 46.4395C153.537 46.4395 154.053 46.5265 154.526 46.7007C154.999 46.8748 155.343 47.0486 155.543 47.2227L155.845 47.4694L155.2 48.6586C155.128 48.5861 155.028 48.5135 154.898 48.4119C154.769 48.3103 154.512 48.1801 154.124 48.0205C153.738 47.8609 153.365 47.7738 152.978 47.7738C151.932 47.7738 151.143 48.4409 151.143 49.2677C151.143 50.0365 151.903 50.5585 152.863 50.9504C154.268 51.4869 156.074 52.2266 156.045 54.1411C156.045 54.9679 155.759 55.6495 155.171 56.2006C154.583 56.7517 153.809 57.0274 152.834 57.0274C151.143 57.0274 149.968 56.1861 149.624 55.8088Z" fill="#544F45"/>
          <path d="M40.783 0.740234H1.6532C0.740583 0.740234 0 1.48962 0 2.4131V47.5655C2.35011 48.0902 4.90893 48.0501 7.60088 47.0095C12.431 45.1432 15.9549 40.6686 16.4165 35.4575C16.7743 31.4177 15.3963 27.7022 12.953 24.9833C12.47 24.4463 12.8431 23.5886 13.5605 23.5886H28.7378C29.4454 23.5886 29.8399 24.4403 29.3636 24.9685C27.1283 27.4486 25.7805 30.7618 25.832 34.3955C25.8912 38.5414 27.9 42.3306 31.0303 44.8472C31.1373 44.9324 31.2451 45.0153 31.3539 45.0981C31.559 45.2532 31.765 45.4086 31.9789 45.5533C32.321 45.7817 32.6727 45.9967 33.0352 46.1953C33.1665 46.2679 33.3016 46.337 33.4347 46.4069C33.6885 46.5356 33.9411 46.6566 34.1928 46.7666C34.3083 46.8178 34.4232 46.872 34.5407 46.919C34.8265 47.0374 35.1093 47.1374 35.391 47.2321C35.4844 47.2635 35.5785 47.3009 35.6699 47.3291C36.0404 47.4445 36.4076 47.5396 36.7722 47.6186C36.8575 47.6369 36.9413 47.6469 37.0266 47.6637C37.3056 47.7179 37.5837 47.7649 37.8585 47.7981C37.9857 47.8141 38.1133 47.8229 38.2404 47.8348C38.4707 47.8561 38.7013 47.873 38.9296 47.8817C39.0636 47.8859 39.1987 47.8878 39.3319 47.8878C39.5546 47.889 39.775 47.8829 39.9946 47.873C40.1229 47.8661 40.2505 47.8615 40.3777 47.8508C40.6109 47.8321 40.8434 47.805 41.0725 47.7748C41.1793 47.7599 41.2884 47.75 41.3944 47.7336C41.7265 47.6812 42.056 47.6194 42.3806 47.5445V2.35705C42.3806 1.46411 41.6646 0.740234 40.783 0.740234Z" fill="#8D2160"/>
          <path d="M40.7634 56.7639H1.65208C0.73856 56.7639 0 56.0146 0 55.0912V52.4863H42.4164V55.0912C42.4164 56.0146 41.676 56.7639 40.7634 56.7639Z" fill="#544F45"/>
          <path d="M21.5495 4.47515C21.2919 4.13589 20.806 4.13589 20.5504 4.47515C18.0752 7.74091 14.1811 9.84758 9.79991 9.84758C8.57342 9.84758 7.3906 9.67535 6.26315 9.36273C5.75584 9.22193 5.31858 9.73252 5.52842 10.2201C8.12824 16.288 14.0973 20.5341 21.049 20.5341C28.0027 20.5341 33.9709 16.288 36.5716 10.2201C36.7803 9.73252 36.343 9.22193 35.8357 9.36273C34.7085 9.67535 33.5248 9.84758 32.3001 9.84758C27.918 9.84758 24.024 7.74091 21.5495 4.47515Z" fill="#F6BA94"/>
          <path d="M83.7045 38.3107H53.4473V36.813C53.9534 36.758 54.6844 36.7026 55.2463 36.5376C56.4269 36.1519 57.3266 35.381 57.7761 34.1143C58.4509 32.0767 58.6196 28.2215 58.6196 24.3113V15.6015C58.6196 11.6363 58.4509 7.83638 57.7761 5.79857C57.3266 4.47691 56.3706 3.15829 55.1901 2.77282C54.6844 2.60738 54.0655 2.49736 53.5035 2.44215V0.960938H70.4259V2.44215C69.976 2.49736 69.3009 2.60738 68.7389 2.77282C67.558 3.15829 66.6024 4.47691 66.1529 5.79857C65.4785 7.83638 65.2532 11.6363 65.2532 15.6015V27.3927C65.2532 30.4768 65.4785 32.4041 65.8155 33.5608C66.1529 34.6622 66.7149 35.4883 67.4456 35.9838C68.4015 36.6448 69.8632 36.865 71.0437 36.865H72.562C75.4292 36.865 77.172 35.6536 78.4088 34.2215C80.6577 31.8536 82.2666 26.6782 83.0531 24.4756H84.5827L83.7045 38.3107Z" fill="#544F45"/>
          <path d="M143.718 38.09C139.881 38.09 132.315 37.2149 132.315 37.2149H131.99L131.721 24.4735H133.344C135.074 30.6529 137.827 36.6123 143.826 36.6123C147.933 36.6123 150.15 34.4263 150.15 31.2544C150.15 27.864 148.095 25.895 142.258 23.4892C137.233 21.4658 131.504 18.2395 131.504 11.0756C131.504 4.89602 137.125 0.740234 143.448 0.740234C146.744 0.740234 153.283 1.61532 153.283 1.61532L153.932 12.9898H153.553C152.905 10.4742 151.715 7.46646 150.365 5.55249C148.798 3.36508 146.798 2.2726 143.61 2.2726C140.205 2.2726 137.88 4.3508 137.88 7.13967C137.88 12.116 141.988 12.5522 145.879 14.3567C151.446 16.8724 156.742 18.9502 156.742 26.7699C156.742 34.3166 150.581 38.09 143.718 38.09Z" fill="#544F45"/>
          <path d="M116.51 38.09C112.673 38.09 105.107 37.2149 105.107 37.2149H104.783L104.513 24.4735H106.137C107.867 30.6529 110.62 36.6123 116.619 36.6123C120.726 36.6123 122.943 34.4263 122.943 31.2544C122.943 27.864 120.888 25.895 115.051 23.4892C110.025 21.4658 104.297 18.2395 104.297 11.0756C104.297 4.89602 109.917 0.740234 116.241 0.740234C119.537 0.740234 126.076 1.61532 126.076 1.61532L126.724 12.9898H126.346C125.698 10.4742 124.508 7.46646 123.158 5.55249C121.59 3.36508 119.591 2.2726 116.402 2.2726C112.998 2.2726 110.672 4.3508 110.672 7.13967C110.672 12.116 114.781 12.5522 118.672 14.3567C124.239 16.8724 129.535 18.9502 129.535 26.7699C129.535 34.3166 123.374 38.09 116.51 38.09Z" fill="#544F45"/>
          <path d="M98.2112 9.87092C100.535 9.87092 102.318 8.06613 102.318 5.71471C102.318 3.36308 100.481 1.50391 98.2112 1.50391C95.9415 1.50391 94.1035 3.41789 94.1035 5.71471C94.1035 8.01133 95.8871 9.87092 98.2112 9.87092Z" fill="#544F45"/>
          <path d="M95.3539 34.8084C94.9217 34.8084 94.5975 34.4802 94.5975 33.7695C94.5975 32.5116 95.6245 29.2304 96.9756 25.4575C98.3803 21.6841 99.1766 18.1536 99.4615 16.8171C100.032 14.138 97.9647 12.4254 95.7497 12.3669C92.2671 12.275 88.9414 13.9196 86.3377 17.2427L87.3612 17.9386C88.5798 16.4933 89.6124 15.7782 90.1661 15.7782C90.7605 15.7782 91.193 15.9422 91.193 16.9263C91.193 18.6762 89.5716 22.559 88.653 25.0745C87.5186 28.4102 85.8965 32.4022 85.8965 34.3161C85.8965 36.7772 88.1677 38.0895 90.2219 38.0895C93.6555 38.0895 97.1499 36.1166 99.6547 33.4045L98.7097 32.7618C97.4386 34.0251 96.1245 34.8084 95.3539 34.8084Z" fill="#544F45"/>
        </svg>
      </div>
      <div class="card-link novidades" style="background-image: url('./img/cover-intro.webp')">
        <a class="btn btn-md btn-primary" href="./categorias/newer.html">Ver Novidades →</a>
      </div>
      <h2 class="h6">Navegue pelas categorias</h2>
      <ul class="list-products">
        <li>
          <img src="/img/Legging Unico.webp" alt="" />
          <p class="h6">Legging + Top Tamanho Único</p>
          <a class='leg+Tu h7' href="./categorias/legTu.html"
            >Ver produtos →</a>
        </li>
        <li>
          <img src="img/Legging Plus.webp" alt="" />
          <p class="h6">Legging + Top Plus Size</p>
          <a class='leg+Tp h7' href="./categorias/legTp.html"
            >Ver produtos →</a>
        </li>
        <li>
          <img src="/img/Short Unico.webp" alt="" />
          <p class="h6">Short + Top Tamanho Único</p>
          <a class='sho+Tu h7' href="./categorias/shoTu.html"
            >Ver produtos →</a>
        </li>
        <li>
          <img src="img/Short Plus.webp" alt="" />
          <p class="h6">Short + Top Plus Size</p>
          <a class='sho+Tp h7' href="./categorias/shoTp.html"
          >Ver produtos →</a>
        </li>
        <li>
          <img src="img/Macacao Unico.webp" alt="" />
          <p class="h6">Macacão Tamanho Único</p>
          <a class='mac+tu h7' href="./categorias/macTu.html"
            >Ver produtos →</a>
        </li>
        <li>
          <img src="/img/Macacao Plus.webp" alt="" />
          <p class="h6">Macacão Plus Size</p>
          <a class='mac+tp h7' href="./categorias/macTp.html"
            >Ver produtos →</a>
        </li>
      </ul>
    </div>


    <script>
      function tu(){
        unico = true
      }

      function tp(){
        plus = true
      }

      function lcl(){
        legging = true
      }

      function scl(){
        short = true
      }

      function mac(){
        macacao = true
      }


      let productsClean = []; //armazenará o array com produtos >tratados<

      async function fetchProducts(page = 1, dataProducts = []) {
        const apiEndpoint = `https://lissfitness.com.br/wp-json/wc/v3/products?page=${page}&per_page=100&orderby=title&order=asc&stock_status=instock&consumer_key=ck_148198b90ab9d891ca88eb7368afec072dbe43d0&consumer_secret=cs_6be934eea1423037e5ff3e18ba247bd65a3eb856`;

        console.log(`Fetching page: ${page}`);

        const responseProducts = await fetch(apiEndpoint)
          .then((x) => x.json())
          .catch((e) => {
            console.error(e); // error handling
            return []; //returns no-results
          });

        console.log(
          `Fetched ${responseProducts.length} ${
            responseProducts.length !== 1 ? "items" : "item"
          } on page ${page}`
        );

        responseProducts.forEach((product) => {
          dataProducts.push(product);
        });

        page++;

        if (responseProducts.length >= 100)
          return fetchProducts(page, dataProducts);
        else return dataProducts;
      }

      // Executa a função de receber os itens da API e salvar como .json e gera uma lista tratada a partir das informações obtidas
      fetchProducts().then((products) => {
        let listIteration = []; // Lista que irá guardar todos os nomes (sem a cor) de produtos já processados

        products.forEach((product) => {
          // -> extrair a string de cor do nome do produto,
          product.color_variations = product.name
            .split(
              /\b(Compressão |Suplex Poliamida |Dryfit |Tule | Trilobal |Jacquard Ondinha |Jacquard Zig |Jacquard Zebra |Jacquard Boreal |Jacquard Spot |Jacquard Chevry )\b/gm
            )
            .pop();

          // -> extrair a informação de nome do produto até o nome do tecido, e gravar na variavel "name"
          let name = product.name.split(" " + product.color_variations).shift();

          let variationColor = {
            color_name: product.color_variations,
            images: product.images,
            slug: product.slug,
            permalink: product.permalink,
            // date_created: product.date_created,
          };

          let productNew = {
            class: product.id,
            name: name,
            status: product.status,
            sku: product.sku,
            price: product.price,
            price_sale: product.price_sale,
            price_interest: product.price_interest,
            price_interest_sale: product.price_interest_sale,
            on_sale: product.on_sale,
            // stock_status: product.stock_status,
            categories: product.categories,
            images: product.images,
            attributes: product.attributes,
            color_variations: [],
          };

          // Caso o nome não exista na lista de iteração, fazer algumas coisas
          if (listIteration.indexOf(name) === -1) {
            // Registrar nome na lista de iteração para as próximas conferências em 'products'
            listIteration.push((name = name));

            productNew.color_variations.push(variationColor);
            productsClean.push(productNew);
          } else {
            productsClean[productsClean.length - 1].color_variations.push(
              variationColor
            );
          }
        });
      });
    </script>
  </body>
</html>